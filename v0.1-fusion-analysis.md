# v0.1 基础准备版 - 融合分析和实施方案

## 📋 版本目标
搭建融合开发环境，确保现有flux-kontext功能正常运行的同时，为集成directory功能做好准备。

---

## 🔍 Directory项目结构分析

### 核心依赖对比
```yaml
Directory项目关键依赖:
  - Next.js: 14.2.15 (我们: 15.3.2) ✅ 兼容
  - React: 18.3.1 (我们: 18.3.1) ✅ 完全匹配
  - TypeScript: 5.6.3 (我们: 5.8.3) ✅ 兼容
  - Tailwind: 3.4.14 (我们: 3.4.17) ✅ 兼容
  - Radix UI: 多个组件 (我们: 已有部分) ✅ 可扩展

新增需要的依赖:
  - @ai-sdk/anthropic: "^0.0.56" # Claude AI集成
  - drizzle-orm: "^0.33.0" # 数据库ORM (需要与Supabase整合)
  - exa-js: "^1.3.2" # 语义搜索
  - cheerio: "^1.0.0" # 网页解析
  - react-markdown: "^9.0.1" # Markdown渲染
  - zod: "^3.23.8" # 数据验证
```

### 可复用的核心组件
```yaml
高价值组件 (直接复用):
  - bookmark-card.tsx # 内容卡片组件
  - bookmark-grid.tsx # 网格布局组件
  - search-bar.tsx # 搜索框组件
  - category-filter.tsx # 分类筛选组件
  - theme-toggle.tsx # 主题切换 (可与我们的整合)

管理功能组件:
  - admin/* # 完整的管理面板组件
  - email-form.tsx # 邮件订阅表单

工具组件:
  - craft.tsx # 内容处理工具
  - search-results-counter.tsx # 搜索结果计数
```

### 数据库架构分析
```yaml
Directory的Drizzle Schema:
  - bookmarks表: 书签/内容管理
  - categories表: 分类系统
  - 使用SQLite (Turso)

我们的Supabase Schema:
  - users, credits, orders等: 用户和支付系统
  - 需要添加: bookmarks, categories表
```

---

## 🔗 融合策略设计

### 阶段1: 依赖融合 (当前任务)
```yaml
1. 更新package.json:
   - 添加directory项目的核心依赖
   - 保持现有依赖不变
   - 解决版本冲突

2. 环境变量扩展:
   - 保持现有FAL_KEY, SUPABASE等
   - 添加ANTHROPIC_API_KEY
   - 添加EXASEARCH_API_KEY
   - 添加LOOPS_API_KEY (可选)

3. 配置文件调整:
   - 创建labubu.config.ts (基于directory.config.ts)
   - 更新next.config.js
   - 调整TypeScript配置
```

### 阶段2: 组件集成
```yaml
1. 创建新的页面结构:
   /labubu-news (快报)
   /labubu-gallery (秀场)
   /admin (管理面板)

2. 组件分类放置:
   src/components/directory/ # directory功能组件
   src/components/labubu/ # Labubu主题组件
   src/components/admin/ # 管理功能组件

3. 保持现有组件:
   src/components/FluxKontextGenerator.tsx # 核心AI生成
   src/components/Navigation.tsx # 导航 (需要扩展)
   所有现有的支付、用户、认证组件
```

### 阶段3: 数据库扩展
```yaml
1. Supabase Schema扩展:
   - 添加bookmarks表
   - 添加categories表
   - 保持现有表结构不变
   - 添加关联外键

2. API路由扩展:
   - 保持现有: /api/flux-kontext, /api/user, /api/payment
   - 新增: /api/bookmarks, /api/categories, /api/search
```

---

## 💻 v0.1 实施步骤

### 步骤1: 依赖更新
```bash
# 1. 备份当前package.json
cp package.json package.json.backup

# 2. 安装新依赖
npm install @ai-sdk/anthropic@^0.0.56
npm install exa-js@^1.3.2
npm install cheerio@^1.0.0
npm install react-markdown@^9.0.1
npm install zod@^3.23.8
npm install sonner@^1.7.0
npm install use-debounce@^10.0.4

# 3. 安装开发依赖
npm install --save-dev drizzle-kit@^0.24.2
npm install --save-dev tsx@^4.19.2
```

### 步骤2: 配置文件创建
```typescript
// labubu.config.ts
export const labubu = {
  baseUrl: process.env.NEXT_PUBLIC_SITE_URL || "http://localhost:3000",
  name: "Labubu梦想社区",
  title: "Labubu梦想社区 | 全球首个Labubu主题垂直社区",
  description: "Labubu收藏爱好者的专属社区，AI图像生成、资讯聚合、用户原创分享",
  theme: {
    primaryColor: "#FF6B9D", // Labubu粉色
    secondaryColor: "#FFB6C1", // 浅粉色
    accentColor: "#9C27B0", // 紫色
  }
};
```

### 步骤3: 环境变量扩展
```bash
# 在.env.local中添加
ANTHROPIC_API_KEY=your_anthropic_key_here
EXASEARCH_API_KEY=your_exa_search_key_here
LOOPS_API_KEY=your_loops_key_here # 可选
```

### 步骤4: 基础组件复制
```yaml
复制策略:
1. 从temp/directory-analysis/components/复制核心组件
2. 适配我们的项目结构
3. 更新import路径
4. 确保与现有样式系统兼容
```

### 步骤5: 页面结构创建
```yaml
新建页面:
- src/app/labubu-news/page.tsx (空页面，显示"开发中")
- src/app/labubu-gallery/page.tsx (空页面，显示"开发中")
- src/app/admin/page.tsx (基础管理页面)

导航更新:
- 更新src/components/Navigation.tsx
- 添加新的菜单项
```

---

## ✅ v0.1 交付检查清单

### 功能完整性
- [ ] 现有AI图像生成功能完全正常
- [ ] 现有用户认证和支付功能正常
- [ ] 新增的空白页面可以正常访问
- [ ] 依赖安装无冲突，项目可以正常启动

### 代码质量
- [ ] TypeScript编译无错误
- [ ] ESLint检查通过
- [ ] 新添加的配置文件格式正确
- [ ] 环境变量模板更新

### 项目结构
- [ ] 代码组织清晰，新旧功能分离
- [ ] 组件放置位置合理
- [ ] 导航结构支持新功能
- [ ] Git提交记录清晰

### 文档更新
- [ ] README.md更新新功能说明
- [ ] 环境变量文档更新
- [ ] 开发环境配置指南

---

## 🔄 下个版本预告 (v0.2)

v0.2将专注于数据库扩展：
- Supabase Schema扩展
- 添加bookmarks和categories表
- 创建API路由基础架构
- 数据库迁移脚本

---

**开始执行v0.1融合工作...** 