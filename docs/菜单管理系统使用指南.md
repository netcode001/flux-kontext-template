# 🎛️ 菜单管理系统使用指南

## 📋 概述

菜单管理系统允许管理员通过Web界面动态控制网站头部导航菜单的显示、隐藏、名称和排序，无需修改代码即可灵活调整网站导航结构。

---

## 🚀 快速开始

### 1. 数据库初始化

首先在Supabase中执行数据库初始化脚本：

```sql
-- 执行 scripts/setup-menu-management.sql 中的所有SQL语句
```

### 2. 访问管理界面

管理员登录后访问：`/admin/menu-management`

### 3. 环境变量配置

确保在`.env.local`中设置管理员邮箱：

```env
ADMIN_EMAILS=your-email@example.com,another-admin@example.com
```

---

## 🎯 主要功能

### 📊 菜单列表管理

- **查看所有菜单项**: 展示当前配置的所有菜单，按排序显示
- **层级结构**: 支持父子菜单关系，下拉菜单可视化展示
- **状态标识**: 清晰显示菜单可见性、类型和权限要求

### ➕ 添加菜单项

点击"添加菜单"按钮，填写以下信息：

**基本信息：**
- **菜单Key**: 唯一标识符（如：home, generate）
- **显示名称**: 用户看到的菜单文字
- **链接地址**: 菜单点击后的跳转URL
- **图标Emoji**: 可选的emoji图标

**高级设置：**
- **排序位置**: 数字越小越靠前
- **父菜单**: 选择父菜单创建下拉子项
- **链接目标**: 当前窗口或新窗口打开
- **权限要求**: 如admin, premium等
- **显示状态**: 是否在网站上显示
- **下拉菜单**: 是否作为下拉菜单容器

### ✏️ 编辑菜单项

点击菜单项右侧的编辑按钮进行修改，支持所有字段的更新。

### 👁️ 显示/隐藏控制

点击眼睛图标可快速切换菜单项的显示状态：
- 🟢 **显示**: 菜单在网站上可见
- 🔴 **隐藏**: 菜单暂时隐藏，但配置保留

### 🗑️ 删除菜单项

点击删除按钮可移除菜单项，注意：
- 有子菜单的父菜单无法直接删除
- 需要先删除所有子菜单项

---

## 📋 菜单配置字段说明

| 字段 | 说明 | 示例 | 必填 |
|------|------|------|------|
| **key** | 唯一标识符 | `home`, `generate` | ✅ |
| **label** | 显示名称 | `首页`, `生成图片` | ✅ |
| **href** | 链接地址 | `/`, `/generate` | ✅ |
| **emoji** | 图标emoji | `🏠`, `✨` | ❌ |
| **sort_order** | 排序位置 | `1`, `2`, `3` | ✅ |
| **is_visible** | 是否显示 | `true`, `false` | ✅ |
| **is_dropdown** | 下拉菜单 | `true`, `false` | ✅ |
| **parent_id** | 父菜单ID | UUID或null | ❌ |
| **target** | 链接目标 | `_self`, `_blank` | ❌ |
| **permission_required** | 权限要求 | `admin`, `premium` | ❌ |

---

## 🎨 使用示例

### 示例1：创建基础菜单

```
菜单Key: home
显示名称: 首页
链接地址: /
图标Emoji: 🏠
排序位置: 1
显示状态: ✅ 显示
```

### 示例2：创建下拉菜单

**父菜单：**
```
菜单Key: resources
显示名称: 资源中心
链接地址: /resources
图标Emoji: 📚
下拉菜单: ✅ 是
```

**子菜单：**
```
菜单Key: api-docs
显示名称: API文档
链接地址: /resources/api
父菜单: resources
图标Emoji: 📖
```

### 示例3：管理员专用菜单

```
菜单Key: admin-dashboard
显示名称: 管理后台
链接地址: /admin
权限要求: admin
图标Emoji: ⚙️
```

---

## 🔧 技术实现

### 数据库结构

菜单配置存储在`menu_items`表中，支持：
- 层级关系（parent_id外键）
- 排序控制（sort_order字段）
- 权限控制（permission_required字段）
- 可见性控制（is_visible字段）

### API端点

- `GET /api/menu-items` - 获取公开可见菜单
- `GET /api/admin/menu-items` - 管理员获取所有菜单
- `POST /api/admin/menu-items` - 创建菜单项
- `PUT /api/admin/menu-items` - 更新菜单项
- `DELETE /api/admin/menu-items` - 删除菜单项
- `POST /api/admin/menu-items/batch` - 批量操作

### 前端组件

- `MenuManagement` - 管理界面组件
- `DynamicNavigation` - 动态导航组件
- 自动fallback到静态菜单

---

## 🛡️ 安全考虑

### 权限控制

- 只有配置的管理员邮箱可以访问管理界面
- 使用行级安全策略（RLS）保护数据
- API端点包含严格的权限验证

### 数据验证

- 所有输入都经过Zod schema验证
- 防止SQL注入和XSS攻击
- 唯一性约束防止重复key

---

## 🚨 注意事项

### 性能考虑

- 菜单数据会被缓存，修改后可能需要刷新页面
- 建议菜单项数量控制在20个以内
- 过深的菜单层级影响用户体验

### 操作建议

1. **测试优先**: 新菜单先设为隐藏状态测试
2. **备份重要**: 大量修改前建议备份数据库
3. **渐进更新**: 分批次更新菜单，避免一次性大改
4. **用户体验**: 保持菜单结构的逻辑性和一致性

---

## 🔄 故障排除

### 常见问题

**Q: 菜单管理页面显示"需要管理员权限"**
A: 检查`ADMIN_EMAILS`环境变量是否包含你的邮箱

**Q: 新添加的菜单不显示**
A: 确认菜单的`is_visible`字段设为true，并刷新页面

**Q: 无法删除菜单项**
A: 检查是否有子菜单，需要先删除所有子菜单

**Q: 菜单排序不生效**
A: 确认`sort_order`数值设置正确，数字越小越靠前

### 恢复静态菜单

如果动态菜单出现问题，系统会自动fallback到静态菜单配置，确保网站正常运行。

---

## 📞 技术支持

如有问题，请：
1. 查看浏览器控制台错误信息
2. 检查Supabase数据库连接状态
3. 确认环境变量配置正确
4. 联系技术团队寻求帮助

---

**🎉 菜单管理系统让网站运营更加灵活高效！** 